<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ì˜¨ë§ˆìŒ ì„±ì¥ì¼ê¸° Â· í•™ìƒìš© MVP</title>
  <style>
    body {font-family: system-ui, "Noto Sans KR", sans-serif; background:#fafafc; margin:0; color:#111;}
    .container {max-width:560px; margin:0 auto; padding:16px;}
    .card {background:#fff; border:1px solid #e5e7eb; border-radius:12px; box-shadow:0 2px 6px rgba(0,0,0,.05); padding:16px;}
    input, button {font:inherit;}
    input {width:100%; padding:10px; border:1px solid #ccc; border-radius:8px;}
    button {padding:10px 14px; border:none; border-radius:8px; cursor:pointer;}
    .btn {background:#2563eb; color:#fff;}
    .btn:disabled {opacity:.6; cursor:not-allowed;}
    .kicker{color:#6b7280;font-size:12px;}
  </style>

  <!-- âœ… ì˜›ë‚  ë°©ì‹ (CDN + firebase.initializeApp) -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyCUvpi0A0Olc9t4Aamo6jCL5ZeKSppPmVM",
      authDomain: "haru-dc490.firebaseapp.com",
      databaseURL: "https://haru-dc490-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "haru-dc490",
      storageBucket: "haru-dc490.appspot.com",
      messagingSenderId: "1062975092523",
      appId: "1:1062975092523:web:3750d0e5722cae7767b76e",
      measurementId: "G-6VVS4MSJBT"
    };

    firebase.initializeApp(firebaseConfig);
    console.log("âœ… Firebase initialized:", firebase.apps.length);
    const auth = firebase.auth();
    const db = firebase.firestore();

    const $ = (id) => document.getElementById(id);
    const authView = $("authView");
    const mainView = $("mainView");

    const QUESTIONS = [
      "ì˜¤ëŠ˜ ê°€ì¥ ê¸°ì–µì— ë‚¨ëŠ” ì¼ì€ ë¬´ì—‡ì¸ê°€ìš”?",
      "ì˜¤ëŠ˜ ë‚´ê°€ ëŠë‚€ ê°ì •ì€?",
      "ë‚´ì¼ì˜ ë‚˜ì—ê²Œ í•´ì£¼ê³  ì‹¶ì€ ë§ì€?"
    ];

    function syncUI(user) {
      if (user) {
        authView.style.display = "none";
        mainView.style.display = "block";
        loadQuestion();
        loadAnswer(user.uid);
      } else {
        authView.style.display = "block";
        mainView.style.display = "none";
      }
    }

    function loadQuestion() {
      const q = QUESTIONS[Math.floor(Math.random() * QUESTIONS.length)];
      $("question").textContent = q;
    }

    async function saveAnswer(uid, text) {
      await db.collection("onmind_diary").doc(uid).set({ text, updated: new Date() });
      $("statusMsg").textContent = "ğŸ’¾ ì €ì¥ ì™„ë£Œ!";
    }

    async function loadAnswer(uid) {
      const docSnap = await db.collection("onmind_diary").doc(uid).get();
      if (docSnap.exists) {
        $("answer").value = docSnap.data().text;
        $("statusMsg").textContent = "ì´ì „ ë‹µë³€ ë¶ˆëŸ¬ì˜´.";
      } else {
        $("answer").value = "";
        $("statusMsg").textContent = "ìƒˆ ì¼ê¸° ì‘ì„± ì‹œì‘.";
      }
    }

    $("btnSignup").addEventListener("click", async () => {
      const uid = $("userid").value.trim();
      const pw = $("password").value;
      if (!uid || !pw) return alert("ì•„ì´ë””ì™€ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.");
      try {
        const email = `${uid}@id.onmaum`;
        await auth.createUserWithEmailAndPassword(email, pw);
        alert("íšŒì›ê°€ì… ì„±ê³µ!");
      } catch (e) {
        alert("íšŒì›ê°€ì… ì‹¤íŒ¨: " + e.message);
      }
    });

    $("btnLogin").addEventListener("click", async () => {
      const uid = $("userid").value.trim();
      const pw = $("password").value;
      if (!uid || !pw) return alert("ì•„ì´ë””ì™€ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.");
      try {
        const email = `${uid}@id.onmaum`;
        await auth.signInWithEmailAndPassword(email, pw);
        alert("ë¡œê·¸ì¸ ì„±ê³µ!");
      } catch (e) {
        alert("ë¡œê·¸ì¸ ì‹¤íŒ¨: " + e.message);
      }
    });

    $("btnLogout").addEventListener("click", async () => {
      await auth.signOut();
      alert("ë¡œê·¸ì•„ì›ƒ ì™„ë£Œ");
    });

    $("btnSave").addEventListener("click", async () => {
      const user = auth.currentUser;
      if (!user) return alert("ë¡œê·¸ì¸ ìƒíƒœê°€ ì•„ë‹™ë‹ˆë‹¤.");
      const text = $("answer").value.trim();
      await saveAnswer(user.uid, text);
    });

    firebase.auth().onAuthStateChanged(syncUI);
  </script>
</head>

<body>
  <header>
    <div class="container">
      <h1>ì˜¨ë§ˆìŒ ì„±ì¥ì¼ê¸° Â· í•™ìƒìš© MVP</h1>
      <span class="kicker">íŠ¹ë³„í•œ í•˜ë£¨ Ã— SEL 5-Years Diary</span>
    </div>
  </header>

  <section id="authView" class="container">
    <div class="card">
      <h3>ë¡œê·¸ì¸</h3>
      <div><label>ì•„ì´ë””</label><input id="userid" placeholder="ì˜ˆ: s1234"></div>
      <div><label>ë¹„ë°€ë²ˆí˜¸</label><input id="password" type="password"></div>
      <div style="margin-top:12px;display:flex;gap:8px;">
        <button id="btnLogin" class="btn" style="flex:1;">ë¡œê·¸ì¸</button>
        <button id="btnSignup" style="flex:1;">íšŒì›ê°€ì…</button>
      </div>
      <p class="kicker">Firebase Auth ì—°ë™ í…ŒìŠ¤íŠ¸</p>
    </div>
  </section>

  <section id="mainView" class="container" style="display:none;">
    <div class="card">
      <h3>ì˜¤ëŠ˜ì˜ ë§ˆìŒ ì§ˆë¬¸ ğŸ’­</h3>
      <p id="question" style="font-weight:600;"></p>
      <textarea id="answer" rows="6" placeholder="ì˜¤ëŠ˜ì˜ ìƒê°ì´ë‚˜ ê°ì •ì„ ì ì–´ë³´ì„¸ìš”."></textarea>
      <div style="margin-top:10px;display:flex;gap:8px;">
        <button id="btnSave" class="btn" style="flex:1;">ì €ì¥</button>
        <button id="btnLogout" style="flex:1;">ë¡œê·¸ì•„ì›ƒ</button>
      </div>
      <p id="statusMsg" class="kicker" style="margin-top:8px;">ìƒíƒœ ë©”ì‹œì§€</p>
    </div>
  </section>
</body>
</html>

