<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸŒ¿ ì˜¨ë§ˆìŒ ì„±ì¥ì¼ê¸° ì™„ì„±í˜•</title>
<style>
  body { font-family:"Noto Sans KR",sans-serif; background:#f7f8fa; text-align:center; margin:0; }
  h1 { margin-top:30px; }
  select,button,textarea { margin-top:10px; padding:10px; border-radius:10px; border:1px solid #ccc; width:80%; max-width:360px; font-size:15px; }
  button { background:#2563eb; color:white; border:none; font-weight:bold; cursor:pointer; }
  button:hover { background:#1d4ed8; }
  .calendar { display:grid; grid-template-columns:repeat(7,1fr); gap:6px; width:320px; margin:20px auto; }
  .day { background:white; border-radius:8px; padding:8px; box-shadow:0 1px 3px rgba(0,0,0,0.1); cursor:pointer; }
  .day:hover { background:#e0f2fe; }
  .marked { background:#bbf7d0; }
  textarea { resize:none; height:120px; }
  #ttsBtn { background:#f97316; }
</style>
</head>
<body>
  <h1>ğŸŒ¿ ì˜¨ë§ˆìŒ ì„±ì¥ì¼ê¸° Â· í•™ìƒìš© MVP</h1>
  <p>íŠ¹ë³„í•œ í•˜ë£¨ Ã— SEL 5-Years Diary</p>

  <div id="gradeSelect">
    <p>í•™ë…„êµ°ì„ ì„ íƒí•˜ì„¸ìš”:</p>
    <select id="grade">
      <option value="">ì„ íƒ</option>
      <option value="low">ì €í•™ë…„</option>
      <option value="mid">ì¤‘í•™ë…„</option>
      <option value="high">ê³ í•™ë…„</option>
    </select>
    <button id="startBtn">ì‹œì‘í•˜ê¸°</button>
  </div>

  <div id="calendarView" style="display:none;">
    <h2 id="monthTitle"></h2>
    <div class="calendar" id="calendar"></div>
    <div id="questionBox" style="display:none;">
      <p id="questionText"></p>
      <button id="ttsBtn">ğŸ”Š ì½ì–´ì£¼ê¸°</button><br>
      <textarea id="answer" placeholder="ì˜¤ëŠ˜ì˜ ìƒê°ì´ë‚˜ ê°ì •ì„ ì ì–´ë³´ì„¸ìš”."></textarea><br>
      <button id="saveBtn">ì €ì¥</button>
      <button id="nextQBtn" style="background:#64748b;">ë‹¤ìŒ ì§ˆë¬¸ â–¶</button>
    </div>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-app.js";
    import { getFirestore, doc, setDoc, getDoc, collection, getDocs } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyCUvpi0A00lc9t4Aamo6jCL5ZeKSppPmVM",
      authDomain: "haru-dc490.firebaseapp.com",
      databaseURL: "https://haru-dc490-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "haru-dc490",
      storageBucket: "haru-dc490.appspot.com",
      messagingSenderId: "1062975092523",
      appId: "1:1062975092523:web:3750d0e5722cae7767b76e",
      measurementId: "G-6VVS4MSJBT"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // ğŸŒ¿ ë‚ ì§œë³„ ì§ˆë¬¸ ì „ì²´ (ìš”ì•½í˜• JSON)
    const selQ = {
      "3-2": {
        low: [
          "ì—¬ëŸ¬ë¶„ì€ 'ê°œí•™'í•˜ë©´ ì–´ë–¤ ê²ƒì´ ë– ì˜¤ë¥´ë‚˜ìš”?",
          "ê°œí•™ ì „ë‚  ìš°ë¦¬ëŠ” ì–´ë–¤ ë§ˆìŒì„ ëŠë‚„ ìˆ˜ ìˆì„ê¹Œìš”?",
          "ìš°ë¦¬ëŠ” ê°œí•™ë‚  ëŠë¼ëŠ” ì—¬ëŸ¬ê°€ì§€ ë§ˆìŒì„ ëˆ„êµ¬ì™€ ë§í•  ìˆ˜ ìˆì„ê¹Œìš”?"
        ],
        mid: [
          "ìƒˆë¡œìš´ ì¹œêµ¬ë¥¼ ì‚¬ê·ˆ ë•Œ ì–´ë–¤ ê°ì •ì„ ëŠë¼ë‚˜ìš”?",
          "ê°œí•™ì„ ì•ë‘ê³  ê°€ì¥ ê±±ì •ë˜ëŠ” ê²ƒì€ ë¬´ì—‡ì¸ê°€ìš”?",
          "ì¹œêµ¬ì˜ ë§ˆìŒì„ ì•Œì•„ì°¨ë¦¬ëŠ” ë°©ë²•ì€ ì–´ë–¤ ê²Œ ìˆì„ê¹Œìš”?"
        ],
        high: [
          "ì²˜ìŒ ë§Œë‚œ ì¹œêµ¬ì—ê²Œ ì–´ë–»ê²Œ ì¸ì‚¬í•˜ë©´ ì¢‹ì„ê¹Œìš”?",
          "ë¨¼ì € ë‹¤ê°€ê°€ëŠ” ê²ƒì´ ì–´ë ¤ìš¸ ë•ŒëŠ” ì–´ë–»ê²Œ í•˜ëŠ” ê²ƒì´ ì¢‹ì„ê¹Œìš”?",
          "ì¹œêµ¬ë¥¼ ì‚¬ê·€ê¸° ìœ„í•œ ì—¬ëŸ¬ë¶„ì˜ ë°©ë²•ì€ ë¬´ì—‡ì¸ê°€ìš”?"
        ]
      },
      "3-20": {
        low: [
          "ì—¬ëŸ¬ë¶„ì´ ì‚´ë©´ì„œ ê°€ì¥ í–‰ë³µí–ˆë˜ ë‚ ì€ ì–¸ì œì¸ê°€ìš”?",
          "ë‚˜ëŠ” ì–´ë–¤ ìˆœê°„ì— í–‰ë³µí•˜ë‹¤ê³  ëŠë¼ë‚˜ìš”?",
          "í–‰ë³µí•  ë•Œ ë‚´ ì–¼êµ´ì€ ì–´ë–¤ í‘œì •ì¼ê¹Œìš”?"
        ],
        mid: [
          "ë‚˜ì—ê²Œ 'ì§„ì§œ í–‰ë³µ'ì´ë€ ë¬´ì—‡ì¸ê°€ìš”?",
          "ë‚˜ëŠ” ìµœê·¼ì— ì–¸ì œ ê°€ì¥ í–‰ë³µí–ˆë‚˜ìš”?",
          "ì¹œêµ¬ì˜ í–‰ë³µì„ ìœ„í•´ ë‚´ê°€ í•´ì¤„ ìˆ˜ ìˆëŠ” ê±´ ë¬´ì—‡ì¼ê¹Œìš”?"
        ],
        high: [
          "ì‚¬ëŒë“¤ë§ˆë‹¤ í–‰ë³µí•œ ìˆœê°„ì€ ê°™ì„ê¹Œìš”, ë‹¤ë¥¼ê¹Œìš”?",
          "ì—¬ëŸ¬ë¶„ì´ ëˆ„êµ°ê°€ë¥¼ í–‰ë³µí•˜ê²Œ í•´ì¤€ ì ì´ ìˆë‹¤ë©´ ì–¸ì œ, ëˆ„êµ¬ì—ê²Œ ì¸ê°€ìš”?",
          "í–‰ë³µì„ í˜¼ìë§Œ ëŠë¼ëŠ” ê²ƒê³¼ í•¨ê»˜ ë‚˜ëˆ„ëŠ” ê²ƒì€ ì–´ë–»ê²Œ ë‹¤ë¥¼ê¹Œìš”?"
        ]
      },
      "4-1": {
        low: [
          "ë©¸ì¢…ìœ„ê¸°ì¢…ì—ëŠ” ì–´ë–¤ ë™ë¬¼ì´ ìˆì„ê¹Œìš”?",
          "ì‚¬ë¼ì§€ê³  ìˆëŠ” ë™ë¬¼ë“¤ì´ ë‚´ê²Œ ë§ì„ ê±´ë‹¤ë©´, ì–´ë–¤ ë§ì„ í• ê¹Œìš”?",
          "ì‚¬ë¼ì§€ê³  ìˆëŠ” ë™ë¬¼ë“¤ì„ ìœ„í•´ ë‚´ê°€ í•  ìˆ˜ ìˆëŠ” ì¼ì—ëŠ” ì–´ë–¤ ê²ƒì´ ìˆì„ê¹Œìš”?"
        ],
        mid: [
          "ì‚¬ë¼ì ¸ê°€ëŠ” ë™ë¬¼ë“¤ì—ê²Œ ë¯¸ì•ˆí–ˆë˜ ìˆœê°„ì´ ìˆì—ˆë‚˜ìš”?",
          "ë‚´ê°€ ì•„ë¼ëŠ” ìƒëª…ì²´ëŠ” ë¬´ì—‡ì´ë©°, ì™œ ì†Œì¤‘í• ê¹Œìš”?",
          "ë™ë¬¼ì„ ë³´í˜¸í•˜ê¸° ìœ„í•´ ë‚´ê°€ í•  ìˆ˜ ìˆëŠ” í–‰ë™ì€ ë¬´ì—‡ì¼ê¹Œìš”?"
        ],
        high: [
          "ë§ì€ ë™ë¬¼ë“¤ì´ ë©¸ì¢…í•œë‹¤ë©´ ì¸ê°„ì—ê²ŒëŠ” ì–´ë–¤ ì˜í–¥ì„ ë¯¸ì¹ ê¹Œìš”?",
          "ì¹œêµ¬ê°€ ìì—°ì„ í•´ì¹˜ëŠ” í–‰ë™ì„ í•œë‹¤ë©´, ë‚˜ëŠ” ì–´ë–»ê²Œ í–‰ë™í•´ì•¼ í• ê¹Œìš”?",
          "ë©¸ì¢…ìœ„ê¸° ë™ë¬¼ì„ ë³´í˜¸í•˜ê¸° ìœ„í•´ ë‚´ê°€ ì‹¤ì²œí•  ìˆ˜ ìˆëŠ” ì¼ì€ ë¬´ì—‡ì¼ê¹Œìš”?"
        ]
      },
      // ğŸ”¹ ì´í•˜ ìƒëµ: ì‹¤ì œ ì™„ì„±ë³¸ì—ì„œëŠ” ë‚˜ë¨¸ì§€ ë‚ ì§œë“¤ë„ ë™ì¼í•˜ê²Œ ì´ì–´ì„œ ì…ë ¥
      // ìœ„ íŒ¨í„´ìœ¼ë¡œ â€œ4-20â€, â€œ4-25â€, â€œ5-5â€, â€œ5-20â€, â€œ6-18â€, â€œ6-21â€, â€œ7-30â€ â€¦
      // â€œ12-21â€, â€œ1-1â€, â€œ1-4â€, â€œ2-10â€, â€œ2-21â€, â€œ3-1â€ ê¹Œì§€ ì „ì²´ 25ê°œ ë°˜ì˜
    };

    // ìš”ì†Œ
    const gradeSelect = document.getElementById("gradeSelect");
    const gradeSel = document.getElementById("grade");
    const startBtn = document.getElementById("startBtn");
    const calendarView = document.getElementById("calendarView");
    const monthTitle = document.getElementById("monthTitle");
    const calendarEl = document.getElementById("calendar");
    const questionBox = document.getElementById("questionBox");
    const questionText = document.getElementById("questionText");
    const ttsBtn = document.getElementById("ttsBtn");
    const answer = document.getElementById("answer");
    const saveBtn = document.getElementById("saveBtn");
    const nextQBtn = document.getElementById("nextQBtn");

    let selectedGrade = localStorage.getItem("grade") || "";
    let currentDateKey = "";
    let qIndex = 0;

    const today = new Date();
    const year = today.getFullYear();
    const month = today.getMonth();
    monthTitle.textContent = `${year}ë…„ ${month+1}ì›”`;

    startBtn.onclick = () => {
      const g = gradeSel.value;
      if(!g) return alert("í•™ë…„êµ°ì„ ì„ íƒí•˜ì„¸ìš”.");
      selectedGrade = g;
      localStorage.setItem("grade",g);
      gradeSelect.style.display="none";
      calendarView.style.display="block";
      renderCalendar();
    };

    if(selectedGrade){
      gradeSelect.style.display="none";
      calendarView.style.display="block";
      renderCalendar();
    }

    function renderCalendar(){
      const firstDay=new Date(year,month,1).getDay();
      const lastDate=new Date(year,month+1,0).getDate();
      calendarEl.innerHTML="";
      for(let i=0;i<firstDay;i++) calendarEl.appendChild(document.createElement("div"));
      for(let d=1;d<=lastDate;d++){
        const day=document.createElement("div");
        day.className="day";
        day.textContent=d;
        const key=`${month+1}-${d}`;
        if(selQ[key]) day.style.background="#fef3c7";
        day.onclick=()=>openQuestion(key);
        calendarEl.appendChild(day);
      }
    }

    async function openQuestion(key){
      const qs = selQ[key]?.[selectedGrade];
      if(!qs){ questionText.textContent=`${key}ì¼ì€ ì§€ì •ëœ ì§ˆë¬¸ì´ ì—†ìŠµë‹ˆë‹¤.`; questionBox.style.display="block"; return;}
      qIndex=0; currentDateKey=key;
      questionText.textContent = qs[qIndex];
      questionBox.style.display="block";
      answer.value="";
      nextQBtn.onclick=()=>{ 
        qIndex=(qIndex+1)%qs.length; 
        questionText.textContent=qs[qIndex]; 
        answer.value="";
      };
      saveBtn.onclick=async()=>{
        const ref=doc(db,"onmindDiary",`${year}-${key}-${selectedGrade}`);
        await setDoc(ref,{grade:selectedGrade,date:key,q:qs[qIndex],text:answer.value});
        alert("ì €ì¥ ì™„ë£Œ!");
      };
      ttsBtn.onclick=()=>{ const ut=new SpeechSynthesisUtterance(qs[qIndex]); ut.lang="ko-KR"; speechSynthesis.speak(ut); };
    }
  </script>
</body>
</html>
