<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>ğŸŒ¿ ì˜¨ë§ˆìŒ ì„±ì¥ì¼ê¸° Â· í•™ìƒìš© MVP</title>
<style>
body{font-family:"Noto Sans KR",sans-serif;background:#f5f6fa;margin:0}
.card{background:white;padding:20px;border-radius:16px;box-shadow:0 4px 10px rgba(0,0,0,.1);width:400px;max-width:90%;margin:0 auto;text-align:center}
h1{font-size:22px;margin:10px 0}
input,button,textarea,select{width:100%;padding:10px;margin:6px 0;border-radius:8px;border:1px solid #ccc;font-size:15px}
button{cursor:pointer;background:#2563eb;color:white;font-weight:600;border:none}
button:hover{background:#1d4ed8}
.ghost{background:#e5e7eb;color:black}
.small{font-size:13px;color:gray}
.calendar{display:grid;grid-template-columns:repeat(7,1fr);gap:6px;margin-top:12px}
.day{background:#fff;border:1px solid #ddd;border-radius:8px;aspect-ratio:1/1;position:relative;cursor:pointer}
.day .num{position:absolute;top:4px;right:6px;font-size:12px;color:#555}
.day .tag{position:absolute;left:4px;bottom:4px;font-size:10px;background:#fff8d1;border-radius:4px;padding:2px 3px;color:#222;border:1px solid #fde68a;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
.star{position:absolute;top:4px;left:4px;color:#f59e0b;font-size:12px}
.today{outline:2px solid #2563eb}
.grid{display:grid;grid-template-columns:340px 1fr;gap:12px;max-width:900px;margin:20px auto}
textarea{resize:none;height:90px}
.prev{font-size:12px;color:#555;background:#f9fafb;border:1px solid #e5e7eb}
.divider{height:1px;background:#e5e7eb;margin:10px 0}
</style>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-app.js";
import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-auth.js";
import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-firestore.js";

// ğŸ”¹ Firebase ì„¤ì •
const firebaseConfig={
 apiKey:"AIzaSyCUvpi0A00lc9t4Aamo6jCL5ZeKSppPmVM",
 authDomain:"haru-dc490.firebaseapp.com",
 databaseURL:"https://haru-dc490-default-rtdb.asia-southeast1.firebasedatabase.app",
 projectId:"haru-dc490",
 storageBucket:"haru-dc490.appspot.com",
 messagingSenderId:"1062975092523",
 appId:"1:1062975092523:web:3750d0e5722cae7767b76e",
 measurementId:"G-6VVS4MSJBT"
};
const app=initializeApp(firebaseConfig);
const auth=getAuth(app);
const db=getFirestore(app);

// ğŸ”¹ íŠ¹ë³„í•œ ë‚  ì¼ë¶€ (ì˜ˆì‹œ 3ê°œë§Œ í…ŒìŠ¤íŠ¸ìš©)
const QUESTIONS={
 "03-02":{title:"3ì›” 2ì¼ Â· ê°œí•™",questions:{
  low:["ì—¬ëŸ¬ë¶„ì€ 'ê°œí•™'í•˜ë©´ ì–´ë–¤ ê²ƒì´ ë– ì˜¤ë¥´ë‚˜ìš”?","ê°œí•™ ì „ë‚  ìš°ë¦¬ëŠ” ì–´ë–¤ ë§ˆìŒì„ ëŠë‚„ ìˆ˜ ìˆì„ê¹Œìš”?","ìš°ë¦¬ëŠ” ê°œí•™ë‚  ëŠë¼ëŠ” ì—¬ëŸ¬ê°€ì§€ ë§ˆìŒì„ ëˆ„êµ¬ì™€ ë§í•  ìˆ˜ ìˆì„ê¹Œìš”?"],
  mid:["ìƒˆë¡œìš´ ì¹œêµ¬ë¥¼ ì‚¬ê·ˆ ë•Œ ì–´ë–¤ ê°ì •ì„ ëŠë¼ë‚˜ìš”?","ê°œí•™ì„ ì•ë‘ê³  ê°€ì¥ ê±±ì •ë˜ëŠ” ê²ƒì€ ë¬´ì—‡ì¸ê°€ìš”?","ì¹œêµ¬ì˜ ë§ˆìŒì„ ì•Œì•„ì°¨ë¦¬ëŠ” ë°©ë²•ì€ ì–´ë–¤ ê²Œ ìˆì„ê¹Œìš”?"],
  high:["ì²˜ìŒ ë§Œë‚œ ì¹œêµ¬ì—ê²Œ ì–´ë–»ê²Œ ì¸ì‚¬í•˜ë©´ ì¢‹ì„ê¹Œìš”?","ë¨¼ì € ë‹¤ê°€ê°€ëŠ” ê²ƒì´ ì–´ë ¤ìš¸ ë•ŒëŠ” ì–´ë–»ê²Œ í•˜ëŠ” ê²ƒì´ ì¢‹ì„ê¹Œìš”?","ì¹œêµ¬ë¥¼ ì‚¬ê·€ê¸° ìœ„í•œ ì—¬ëŸ¬ë¶„ì˜ ë°©ë²•ì€ ë¬´ì—‡ì¸ê°€ìš”?"]
 }},
 "03-20":{title:"3ì›” 20ì¼ Â· í–‰ë³µì˜ ë‚ ",questions:{
  low:["ì—¬ëŸ¬ë¶„ì´ ì‚´ë©´ì„œ ê°€ì¥ í–‰ë³µí–ˆë˜ ë‚ ì€ ì–¸ì œì¸ê°€ìš”?","ë‚˜ëŠ” ì–´ë–¤ ìˆœê°„ì— í–‰ë³µí•˜ë‹¤ê³  ëŠë¼ë‚˜ìš”?","í–‰ë³µí•  ë•Œ ë‚´ ì–¼êµ´ì€ ì–´ë–¤ í‘œì •ì¼ê¹Œìš”?"],
  mid:["ë‚˜ì—ê²Œ 'ì§„ì§œ í–‰ë³µ'ì´ë€ ë¬´ì—‡ì¸ê°€ìš”?","ìµœê·¼ ì–¸ì œ ê°€ì¥ í–‰ë³µí–ˆë‚˜ìš”?","ì¹œêµ¬ì˜ í–‰ë³µì„ ìœ„í•´ ë‚´ê°€ í•´ì¤„ ìˆ˜ ìˆëŠ” ê±´ ë¬´ì—‡ì¼ê¹Œìš”?"],
  high:["ì‚¬ëŒë“¤ë§ˆë‹¤ í–‰ë³µí•œ ìˆœê°„ì€ ê°™ì„ê¹Œìš”, ë‹¤ë¥¼ê¹Œìš”?","ëˆ„êµ°ê°€ë¥¼ í–‰ë³µí•˜ê²Œ í•´ì¤€ ì ì´ ìˆë‚˜ìš”?","í–‰ë³µì„ í•¨ê»˜ ë‚˜ëˆ„ëŠ” ê²ƒì€ ì–´ë–»ê²Œ ë‹¤ë¥¼ê¹Œìš”?"]
 }},
 "10-10":{title:"10ì›” 10ì¼ Â· ì •ì‹ ê±´ê°•ì˜ ë‚ ",questions:{
  low:["ì˜¤ëŠ˜ ì—¬ëŸ¬ë¶„ì˜ ë§ˆìŒ ë‚ ì”¨ëŠ” ì–´ë–¤ê°€ìš”?","ë§ˆìŒ ë‚ ì”¨ê°€ íë¦° ë‚  ìš°ë¦¬ëŠ” ë¬´ì—‡ì„ í•  ìˆ˜ ìˆì„ê¹Œìš”?","ë‚´ ë§ˆìŒì—ê²Œ í•´ì£¼ê³  ì‹¶ì€ ë§ì´ ìˆë‹¤ë©´?"],
  mid:["ì˜¤ëŠ˜ ë‚˜ì˜ ê°ì •ì„ ìƒ‰ê¹”ë¡œ í‘œí˜„í•œë‹¤ë©´?","ë§ˆìŒì´ í˜ë“¤ ë•Œ ë„ì™€ì¤„ ì‚¬ëŒì€?","ê¸°ë¶„ì´ ì¢‹ì•„ì§€ëŠ” ë‚˜ë§Œì˜ ë°©ë²•ì€?"],
  high:["ì˜¤ëŠ˜ ë‚˜ì˜ ê°ì •ì„ ìƒ‰ê¹”ë¡œ í‘œí˜„í•œë‹¤ë©´?","ë§ˆìŒì„ ê±´ê°•í•˜ê²Œ ìœ ì§€í•˜ëŠ” ê±´ ì™œ ì¤‘ìš”í• ê¹Œìš”?","ì—¬ëŸ¬ë¶„ì€ ì–´ë–¤ ë…¸ë ¥ì„ í•˜ë‚˜ìš”?"]
 }}
};

// í•™ë…„êµ° êµ¬ë¶„
function band(n){n=Number(n||1);if(n<=2)return'low';if(n<=4)return'mid';return'high';}

// DOM ë¡œë“œ í›„ ì‹¤í–‰
window.addEventListener("DOMContentLoaded",()=>{
 const loginView=document.getElementById("loginView");
 const mainView=document.getElementById("mainView");
 const loginBtn=document.getElementById("loginBtn");
 const signupBtn=document.getElementById("signupBtn");
 const logoutBtn=document.getElementById("logoutBtn");
 const yearSel=document.getElementById("yearSel");
 const monthSel=document.getElementById("monthSel");
 const gradeSel=document.getElementById("gradeSel");
 const calEl=document.getElementById("calendar");
 const qBox=document.getElementById("qBox");
 const saveBtn=document.getElementById("saveBtn");
 const qTitle=document.getElementById("qTitle");

 let viewYear=new Date().getFullYear();
 let viewMonth=new Date().getMonth();

 // ë¡œê·¸ì¸
 signupBtn.onclick=async()=>{
  const id=document.getElementById("userid").value.trim();
  const pw=document.getElementById("password").value.trim();
  if(!id||!pw)return alert("ì…ë ¥!");
  const email=`${id}@id.onmaum`;
  try{await createUserWithEmailAndPassword(auth,email,pw);alert("íšŒì›ê°€ì… ì„±ê³µ");}
  catch(e){alert(e.message);}
 };
 loginBtn.onclick=async()=>{
  const id=document.getElementById("userid").value.trim();
  const pw=document.getElementById("password").value.trim();
  if(!id||!pw)return alert("ì…ë ¥!");
  const email=`${id}@id.onmaum`;
  try{await signInWithEmailAndPassword(auth,email,pw);
    loginView.style.display="none";mainView.style.display="block";
    renderCal();
  }catch(e){alert(e.message);}
 };
 logoutBtn.onclick=async()=>{await signOut(auth);mainView.style.display="none";loginView.style.display="block";};

 // ì…€ë ‰íŠ¸ êµ¬ì„±
 for(let y=2024;y<=2026;y++){const o=document.createElement("option");o.value=y;o.textContent=y;yearSel.appendChild(o);}
 yearSel.value=viewYear;
 for(let m=1;m<=12;m++){const o=document.createElement("option");o.value=m-1;o.textContent=m;monthSel.appendChild(o);}
 monthSel.value=viewMonth;

 yearSel.onchange=()=>{viewYear=Number(yearSel.value);renderCal();}
 monthSel.onchange=()=>{viewMonth=Number(monthSel.value);renderCal();}

 function renderCal(){
  calEl.innerHTML="";
  const first=new Date(viewYear,viewMonth,1);
  const last=new Date(viewYear,viewMonth+1,0);
  const start=first.getDay();
  for(let i=0;i<start;i++){calEl.appendChild(document.createElement("div"));}
  for(let d=1;d<=last.getDate();d++){
   const cell=document.createElement("div");cell.className="day";
   const key=`${String(viewMonth+1).padStart(2,"0")}-${String(d).padStart(2,"0")}`;
   if(QUESTIONS[key]){
    const s=document.createElement("div");s.className="star";s.textContent="â˜…";cell.appendChild(s);
    const tag=document.createElement("div");tag.className="tag";tag.textContent=QUESTIONS[key].title.split("Â·")[1];cell.appendChild(tag);
   }
   const num=document.createElement("div");num.className="num";num.textContent=d;cell.appendChild(num);
   if(viewYear===new Date().getFullYear()&&viewMonth===new Date().getMonth()&&d===new Date().getDate())cell.classList.add("today");
   cell.onclick=()=>openDay(key);
   calEl.appendChild(cell);
  }
 }

 async function openDay(key){
  qBox.innerHTML="";
  if(!QUESTIONS[key]){qTitle.textContent="ë“±ë¡ëœ ì§ˆë¬¸ì´ ì—†ìŠµë‹ˆë‹¤.";return;}
  const g=band(gradeSel.value);
  const qset=QUESTIONS[key].questions[g];
  qTitle.textContent=QUESTIONS[key].title;
  const user=auth.currentUser;
  const docId=`${user.uid}_${viewYear}_${key}`;
  const ref=doc(db,"entries",docId);
  const snap=await getDoc(ref);
  const prev=snap.exists()?snap.data():{};
  qset.forEach((q,i)=>{
   const p=document.createElement("p");p.textContent=`Q${i+1}. ${q}`;qBox.appendChild(p);
   const ta=document.createElement("textarea");ta.id=`a${i}`;ta.value=prev.answers?prev.answers[i]||"":"";qBox.appendChild(ta);
  });
  saveBtn.onclick=async()=>{
   const ans=[...qBox.querySelectorAll("textarea")].map(t=>t.value);
   await setDoc(ref,{year:viewYear,key,band:g,answers:ans,savedAt:new Date().toISOString()});
   alert("ì €ì¥ ì™„ë£Œ!");
  };
 }

 renderCal();
});
</script>
</head>

<body>
<div id="loginView" class="card">
 <h1>ì˜¨ë§ˆìŒ ì„±ì¥ì¼ê¸°</h1>
 <input id="userid" placeholder="ì•„ì´ë””">
 <input id="password" type="password" placeholder="ë¹„ë°€ë²ˆí˜¸">
 <button id="loginBtn">ë¡œê·¸ì¸</button>
 <button id="signupBtn" class="ghost">íšŒì›ê°€ì…</button>
</div>

<div id="mainView" style="display:none;">
 <div class="grid">
  <div class="card">
   <h3>ğŸ“… ë‹¬ë ¥</h3>
   <select id="yearSel"></select>
   <select id="monthSel"></select>
   <select id="gradeSel">
    <option value="1">1í•™ë…„</option>
    <option value="2">2í•™ë…„</option>
    <option value="3">3í•™ë…„</option>
    <option value="4">4í•™ë…„</option>
    <option value="5">5í•™ë…„</option>
    <option value="6">6í•™ë…„</option>
   </select>
   <div id="calendar" class="calendar"></div>
   <button id="logoutBtn" class="ghost">ë¡œê·¸ì•„ì›ƒ</button>
  </div>
  <div class="card">
   <h3 id="qTitle">ë‚ ì§œë¥¼ ì„ íƒí•˜ì„¸ìš”</h3>
   <div id="qBox"></div>
   <div class="divider"></div>
   <button id="saveBtn">ì €ì¥</button>
  </div>
 </div>
</div>
</body>
</html>
