<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ì˜¨ë§ˆìŒ ì„±ì¥ì¼ê¸° Â· í•™ìƒìš© MVP</title>
  <style>
    :root {
      --bg: #f7f8fa;
      --card: #fff;
      --line: #ddd;
      --accent: #2563eb;
      --muted: #777;
      --ink: #111;
    }
    body {
      font-family: "Noto Sans KR", sans-serif;
      background: var(--bg);
      color: var(--ink);
      margin: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
    }
    .container {
      width: 100%;
      max-width: 480px;
      background: var(--card);
      border-radius: 14px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
      padding: 24px;
      margin-top: 40px;
    }
    h1 { font-size: 20px; margin: 0 0 4px; text-align: center; }
    .kicker { font-size: 13px; color: var(--muted); text-align: center; margin-bottom: 16px; }
    label { font-size: 14px; display: block; margin-top: 12px; }
    input, select, textarea {
      width: 100%;
      padding: 10px;
      border: 1px solid var(--line);
      border-radius: 10px;
      margin-top: 6px;
      font-size: 14px;
    }
    button {
      width: 100%;
      padding: 12px;
      border: none;
      border-radius: 10px;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
    }
    .btn-accent { background: var(--accent); color: #fff; }
    .btn-gray { background: #eee; color: #333; }
    .center { text-align: center; margin-top: 16px; }
    .question { font-weight: 600; margin-bottom: 8px; }
  </style>

  <script src="https://www.gstatic.com/firebasejs/11.0.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/11.0.2/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/11.0.2/firebase-database-compat.js"></script>
</head>
<body>
  <div class="container" id="loginView">
    <h1>ì˜¨ë§ˆìŒ ì„±ì¥ì¼ê¸° Â· í•™ìƒìš© MVP</h1>
    <div class="kicker">íŠ¹ë³„í•œ í•˜ë£¨ Ã— SEL 5-Years Diary</div>
    <label>ì•„ì´ë””</label>
    <input type="text" id="userId" placeholder="ì˜ˆ: s1234">
    <label>ë¹„ë°€ë²ˆí˜¸</label>
    <input type="password" id="userPw" placeholder="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥">
    <button class="btn-accent" id="loginBtn">ë¡œê·¸ì¸</button>
    <button class="btn-gray" id="signupBtn">íšŒì›ê°€ì…</button>
  </div>

  <div class="container" id="mainView" style="display:none;">
    <h1>ì˜¤ëŠ˜ì˜ ë§ˆìŒ ì§ˆë¬¸ ğŸ’­</h1>
    <div class="kicker" id="nicknameArea"></div>
    <div class="question" id="todayQ"></div>
    <textarea id="answer" rows="5" placeholder="ì˜¤ëŠ˜ì˜ ìƒê°ì´ë‚˜ ê°ì •ì„ ì ì–´ë³´ì„¸ìš”."></textarea>
    <button class="btn-accent" id="saveBtn">ì €ì¥</button>
    <button class="btn-gray" id="logoutBtn">ë¡œê·¸ì•„ì›ƒ</button>
    <div class="center" id="status"></div>
  </div>

  <script>
    // Firebase ì„¤ì • (âœ… ë„ˆì˜ ì‹¤ì œ config ê·¸ëŒ€ë¡œ ì¨ì•¼ í•¨)
    const firebaseConfig = {
      apiKey: "AIzaSyCUvpi0A00lc9t4Aamo6jCL5ZeK5ppPmVM",
      authDomain: "haru-dc490.firebaseapp.com",
      databaseURL: "https://haru-dc490-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "haru-dc490",
      storageBucket: "haru-dc490.appspot.com",
      messagingSenderId: "1062975092523",
      appId: "1:1062975092523:web:3750d0e5722cae7767b76e",
      measurementId: "G-6VVS4MSJBT"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.database();

    const loginView = document.getElementById("loginView");
    const mainView = document.getElementById("mainView");
    const loginBtn = document.getElementById("loginBtn");
    const signupBtn = document.getElementById("signupBtn");
    const logoutBtn = document.getElementById("logoutBtn");
    const saveBtn = document.getElementById("saveBtn");

    const todayQ = document.getElementById("todayQ");
    const answer = document.getElementById("answer");
    const status = document.getElementById("status");
    const nicknameArea = document.getElementById("nicknameArea");

    // ì˜¤ëŠ˜ì˜ ì§ˆë¬¸ ìë™ ìƒì„±
    const questions = [
      "ì˜¤ëŠ˜ ê°€ì¥ ê¸°ì–µì— ë‚¨ëŠ” ì¼ì€ ë¬´ì—‡ì¸ê°€ìš”?",
      "ì˜¤ëŠ˜ ë‚´ê°€ ì›ƒê²Œ ëœ ìˆœê°„ì€ ì–¸ì œì˜€ë‚˜ìš”?",
      "ì˜¤ëŠ˜ì˜ ë‚˜ì—ê²Œ í•´ì£¼ê³  ì‹¶ì€ ë§ì€?"
    ];
    const todayIndex = new Date().getDate() % questions.length;
    todayQ.textContent = questions[todayIndex];

    // íšŒì›ê°€ì…
    signupBtn.onclick = async () => {
      const id = userId.value.trim();
      const pw = userPw.value.trim();
      if (!id || !pw) return alert("ì•„ì´ë””ì™€ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.");
      try {
        const email = `${id}@onmaum.com`;
        await auth.createUserWithEmailAndPassword(email, pw);
        alert("íšŒì›ê°€ì… ì„±ê³µ! ì´ì œ ë¡œê·¸ì¸í•˜ì„¸ìš”.");
      } catch (err) {
        alert("íšŒì›ê°€ì… ì‹¤íŒ¨: " + err.message);
      }
    };

    // ë¡œê·¸ì¸
    loginBtn.onclick = async () => {
      const id = userId.value.trim();
      const pw = userPw.value.trim();
      if (!id || !pw) return alert("ì•„ì´ë””ì™€ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”.");
      try {
        const email = `${id}@onmaum.com`;
        await auth.signInWithEmailAndPassword(email, pw);
        loginView.style.display = "none";
        mainView.style.display = "block";
        nicknameArea.textContent = `${id} í•™ìƒì˜ ì˜¤ëŠ˜ ê¸°ë¡`;
        loadAnswer(id);
      } catch (err) {
        alert("ë¡œê·¸ì¸ ì‹¤íŒ¨: " + err.message);
      }
    };

    // ë¡œê·¸ì•„ì›ƒ
    logoutBtn.onclick = async () => {
      await auth.signOut();
      loginView.style.display = "block";
      mainView.style.display = "none";
    };

    // ì €ì¥
    saveBtn.onclick = async () => {
      const user = auth.currentUser;
      if (!user) return;
      const id = user.email.split("@")[0];
      const text = answer.value.trim();
      if (!text) return alert("ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”.");
      const today = new Date().toISOString().split("T")[0];
      await db.ref(`onmaumDiary/${id}/${today}`).set({
        question: todayQ.textContent,
        answer: text,
        date: today
      });
      status.textContent = "âœ… ì €ì¥ ì™„ë£Œ!";
      setTimeout(() => (status.textContent = ""), 2000);
    };

    // ë¶ˆëŸ¬ì˜¤ê¸°
    async function loadAnswer(id) {
      const today = new Date().toISOString().split("T")[0];
      const snap = await db.ref(`onmaumDiary/${id}/${today}`).get();
      if (snap.exists()) answer.value = snap.val().answer;
    }

    // ë¡œê·¸ì¸ ìƒíƒœ ìœ ì§€
    auth.onAuthStateChanged((user) => {
      if (user) {
        loginView.style.display = "none";
        mainView.style.display = "block";
        const id = user.email.split("@")[0];
        nicknameArea.textContent = `${id} í•™ìƒì˜ ì˜¤ëŠ˜ ê¸°ë¡`;
        loadAnswer(id);
      } else {
        loginView.style.display = "block";
        mainView.style.display = "none";
      }
    });
  </script>
</body>
</html>
